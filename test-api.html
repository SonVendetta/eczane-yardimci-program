<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini AI Test - Eczane YardÄ±mcÄ±</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .test-card { background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .result-box { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0; }
        .success { color: #198754; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #0dcaf0; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="row">
            <div class="col-md-8 mx-auto">
                <div class="test-card p-4">
                    <h3 class="text-center mb-4">
                        <i class="fas fa-robot text-primary"></i>
                        Gemini AI Test SayfasÄ±
                    </h3>
                    
                    <div class="mb-4">
                        <h5>Test Durumu</h5>
                        <div id="testStatus" class="result-box">
                            <i class="fas fa-spinner fa-spin"></i> Test baÅŸlatÄ±lÄ±yor...
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h5>API Key Durumu</h5>
                        <div id="apiKeyStatus" class="result-box">
                            Kontrol ediliyor...
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h5>BaÄŸlantÄ± Testi</h5>
                        <div id="connectionTest" class="result-box">
                            Test ediliyor...
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h5>AI Analiz Testi</h5>
                        <div class="mb-3">
                            <label class="form-label">Test SemptomlarÄ±:</label>
                            <input type="text" id="testSymptoms" class="form-control" value="baÅŸ aÄŸrÄ±sÄ± ve yorgunluk" placeholder="SemptomlarÄ± girin">
                        </div>
                        <button id="testAnalysis" class="btn btn-primary">
                            <i class="fas fa-brain"></i> AI Analiz Testi
                        </button>
                        <div id="analysisResult" class="result-box mt-3" style="display: none;">
                            Analiz sonucu burada gÃ¶rÃ¼necek...
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h5>Hata AyÄ±klama</h5>
                        <div id="debugInfo" class="result-box">
                            <small>Hata ayÄ±klama bilgileri burada gÃ¶rÃ¼necek...</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="gemini-config.js"></script>
    <script>
        // Test fonksiyonlarÄ±
        async function runTests() {
            updateStatus('testStatus', 'Testler baÅŸlatÄ±lÄ±yor...', 'info');
            
            // API Key kontrolÃ¼
            await checkApiKey();
            
            // BaÄŸlantÄ± testi
            await testConnection();
            
            updateStatus('testStatus', 'TÃ¼m testler tamamlandÄ±!', 'success');
        }
        
        async function checkApiKey() {
            try {
                if (window.geminiAI && window.geminiAI.getApiKey()) {
                    const apiKey = window.geminiAI.getApiKey();
                    const maskedKey = apiKey.substring(0, 10) + '...' + apiKey.substring(apiKey.length - 4);
                    updateStatus('apiKeyStatus', `âœ… API Key ayarlÄ±: ${maskedKey}`, 'success');
                } else {
                    updateStatus('apiKeyStatus', 'âŒ API Key ayarlanmamÄ±ÅŸ', 'error');
                }
            } catch (error) {
                updateStatus('apiKeyStatus', `âŒ API Key hatasÄ±: ${error.message}`, 'error');
            }
        }
        
        async function testConnection() {
            try {
                updateStatus('connectionTest', 'ğŸ”„ BaÄŸlantÄ± test ediliyor...', 'info');
                
                if (!window.geminiAI || !window.geminiAI.isConfigured) {
                    updateStatus('connectionTest', 'âŒ Gemini AI ayarlanmamÄ±ÅŸ', 'error');
                    return;
                }
                
                const response = await window.geminiAI.generateContent('Merhaba, bu bir test mesajÄ±dÄ±r.', 0.1);
                
                if (response && response.length > 0) {
                    updateStatus('connectionTest', `âœ… BaÄŸlantÄ± baÅŸarÄ±lÄ±! YanÄ±t uzunluÄŸu: ${response.length} karakter`, 'success');
                } else {
                    updateStatus('connectionTest', 'âš ï¸ BaÄŸlantÄ± baÅŸarÄ±lÄ± ama yanÄ±t boÅŸ', 'warning');
                }
            } catch (error) {
                updateStatus('connectionTest', `âŒ BaÄŸlantÄ± hatasÄ±: ${error.message}`, 'error');
            }
        }
        
        async function testAnalysis() {
            const symptoms = document.getElementById('testSymptoms').value.trim();
            const resultDiv = document.getElementById('analysisResult');
            
            if (!symptoms) {
                alert('LÃ¼tfen test semptomlarÄ± girin!');
                return;
            }
            
            try {
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> AI analizi yapÄ±lÄ±yor...';
                
                if (!window.geminiAI || !window.geminiAI.isConfigured) {
                    resultDiv.innerHTML = '<div class="error">âŒ Gemini AI ayarlanmamÄ±ÅŸ</div>';
                    return;
                }
                
                // Test verileri
                const testIndications = {
                    "BaÅŸ AÄŸrÄ±sÄ±": {
                        "AÃ§Ä±klama": "BaÅŸ aÄŸrÄ±sÄ± iÃ§in ilaÃ§ ve takviye Ã¶nerileri",
                        "ÃœrÃ¼nler": {
                            "Parol": {
                                "Dozlama": "500-1000 mg",
                                "KullanÄ±m Åekli": "GÃ¼nde 3-4 kez",
                                "Kontrendikasyonlar": "Mide Ã¼lseri"
                            },
                            "C Vitamini": {
                                "Dozlama": "500-1000 mg/gÃ¼n",
                                "KullanÄ±m Åekli": "Yemekle birlikte",
                                "Kontrendikasyonlar": "BÃ¶brek taÅŸÄ± riski"
                            },
                            "Magnezyum": {
                                "Dozlama": "200-400 mg/gÃ¼n",
                                "KullanÄ±m Åekli": "AkÅŸam yemeÄŸinden sonra",
                                "Kontrendikasyonlar": "BÃ¶brek yetmezliÄŸi"
                            }
                        }
                    },
                    "Yorgunluk": {
                        "AÃ§Ä±klama": "Yorgunluk iÃ§in vitamin ve mineral takviyeleri",
                        "ÃœrÃ¼nler": {
                            "B12 Vitamini": {
                                "Dozlama": "1000 mcg/gÃ¼n",
                                "KullanÄ±m Åekli": "AÃ§ karnÄ±na",
                                "Kontrendikasyonlar": "B12 alerjisi"
                            },
                            "Demir": {
                                "Dozlama": "15-30 mg/gÃ¼n",
                                "KullanÄ±m Åekli": "AÃ§ karnÄ±na, C vitamini ile",
                                "Kontrendikasyonlar": "Demir birikimi hastalÄ±klarÄ±"
                            },
                            "Koenzim Q10": {
                                "Dozlama": "100-200 mg/gÃ¼n",
                                "KullanÄ±m Åekli": "Yemekle birlikte",
                                "Kontrendikasyonlar": "Q10 alerjisi"
                            }
                        }
                    },
                    "Stres": {
                        "AÃ§Ä±klama": "Stres yÃ¶netimi iÃ§in bitkisel takviyeler",
                        "ÃœrÃ¼nler": {
                            "Passiflora": {
                                "Dozlama": "250-500 mg/gÃ¼n",
                                "KullanÄ±m Åekli": "Yatmadan Ã¶nce",
                                "Kontrendikasyonlar": "Sedatif etki"
                            },
                            "Melisa": {
                                "Dozlama": "300-600 mg/gÃ¼n",
                                "KullanÄ±m Åekli": "AkÅŸam saatlerinde",
                                "Kontrendikasyonlar": "Sedatif ilaÃ§ kullanÄ±mÄ±"
                            },
                            "Ashwagandha": {
                                "Dozlama": "300-600 mg/gÃ¼n",
                                "KullanÄ±m Åekli": "Sabah veya akÅŸam",
                                "Kontrendikasyonlar": "Hamilelik, emzirme"
                            }
                        }
                    },
                    "Vitamin ve Mineraller": {
                        "AÃ§Ä±klama": "Genel saÄŸlÄ±k iÃ§in vitamin ve mineral takviyeleri",
                        "ÃœrÃ¼nler": {
                            "Multivitamin": {
                                "Dozlama": "GÃ¼nde 1 tablet",
                                "KullanÄ±m Åekli": "KahvaltÄ± ile birlikte",
                                "Kontrendikasyonlar": "Vitamin alerjisi"
                            },
                            "D Vitamini": {
                                "Dozlama": "1000-2000 IU/gÃ¼n",
                                "KullanÄ±m Åekli": "KahvaltÄ± ile birlikte",
                                "Kontrendikasyonlar": "Hipervitaminoz D"
                            }
                        }
                    },
                    "Omega-3 ve YaÄŸ Asitleri": {
                        "AÃ§Ä±klama": "Kalp ve beyin saÄŸlÄ±ÄŸÄ± iÃ§in omega-3 takviyeleri",
                        "ÃœrÃ¼nler": {
                            "Omega-3 BalÄ±k YaÄŸÄ±": {
                                "Dozlama": "1000-2000 mg/gÃ¼n",
                                "KullanÄ±m Åekli": "Yemekle birlikte",
                                "Kontrendikasyonlar": "BalÄ±k alerjisi"
                            }
                        }
                    }
                };
                
                const analysis = await window.geminiAI.analyzeSymptoms(
                    symptoms, 
                    '35', 
                    'Erkek', 
                    '75', 
                    testIndications
                );
                
                console.log('AI Analiz Sonucu:', analysis);
                
                // Sonucu gÃ¶ster
                let resultHtml = '<div class="success"><h6>âœ… AI Analiz BaÅŸarÄ±lÄ±!</h6></div>';
                resultHtml += `<div class="mt-3"><strong>Analiz:</strong> ${analysis.analysis || 'Analiz yapÄ±ldÄ±'}</div>`;
                resultHtml += `<div class="mt-2"><strong>GÃ¼ven Skoru:</strong> %${analysis.confidence || 'N/A'}</div>`;
                
                if (analysis.detected_symptoms && analysis.detected_symptoms.length > 0) {
                    resultHtml += `<div class="mt-2"><strong>Tespit Edilen Semptomlar:</strong> ${analysis.detected_symptoms.join(', ')}</div>`;
                }
                
                if (analysis.recommendations && analysis.recommendations.length > 0) {
                    resultHtml += '<div class="mt-3"><strong>Ã–neriler:</strong></div>';
                    analysis.recommendations.forEach(rec => {
                        resultHtml += `<div class="mt-2">â€¢ ${rec.symptom}: ${rec.description}</div>`;
                    });
                }
                
                if (analysis.warnings && analysis.warnings.length > 0) {
                    resultHtml += '<div class="mt-3"><strong>UyarÄ±lar:</strong></div>';
                    analysis.warnings.forEach(warning => {
                        resultHtml += `<div class="mt-1 text-warning">â€¢ ${warning}</div>`;
                    });
                }
                
                resultDiv.innerHTML = resultHtml;
                
            } catch (error) {
                console.error('AI Analiz HatasÄ±:', error);
                resultDiv.innerHTML = `<div class="error">âŒ AI Analiz HatasÄ±: ${error.message}</div>`;
            }
        }
        
        function updateStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            const icon = type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : type === 'warning' ? 'âš ï¸' : 'ğŸ”„';
            element.innerHTML = `${icon} ${message}`;
            element.className = `result-box ${type}`;
        }
        
        function updateDebugInfo() {
            const debugDiv = document.getElementById('debugInfo');
            let debugInfo = '<strong>Hata AyÄ±klama Bilgileri:</strong><br>';
            
            debugInfo += `â€¢ Gemini AI YÃ¼klÃ¼: ${window.geminiAI ? 'Evet' : 'HayÄ±r'}<br>`;
            if (window.geminiAI) {
                debugInfo += `â€¢ API Key AyarlÄ±: ${window.geminiAI.isConfigured ? 'Evet' : 'HayÄ±r'}<br>`;
                debugInfo += `â€¢ CORS Proxy: ${window.geminiAI.getUseProxy() ? 'Etkin' : 'Devre dÄ±ÅŸÄ±'}<br>`;
            }
            debugInfo += `â€¢ TarayÄ±cÄ±: ${navigator.userAgent}<br>`;
            debugInfo += `â€¢ Zaman: ${new Date().toLocaleString('tr-TR')}`;
            
            debugDiv.innerHTML = debugInfo;
        }
        
        // Event listeners
        document.getElementById('testAnalysis').addEventListener('click', testAnalysis);
        
        // Sayfa yÃ¼klendiÄŸinde testleri baÅŸlat
        window.addEventListener('load', async () => {
            updateDebugInfo();
            await runTests();
        });
    </script>
</body>
</html> 